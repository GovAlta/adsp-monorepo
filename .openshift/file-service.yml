apiVersion: v1
kind: List
items:
- apiVersion: v1
  kind: ImageStream
  metadata:
    labels:
      app: file-service
    name: file-service
  spec: {}
- apiVersion: v1
  kind: BuildConfig
  metadata:
    labels:
      app: file-service
    name: file-service
  spec:
    output:
      to:
        kind: ImageStreamTag
        name: file-service:latest
    postCommit: {}
    resources: {}
    source:
      git:
        uri: https://gitlab.gov.ab.ca/dio/core/core-services.git
        ref: CS-211
      contextDir: apps/file-service
      type: Git
    strategy:
      sourceStrategy:
        from:
          kind: ImageStreamTag
          name: nodejs:12
        incremental: true
      type: Source
    triggers:
    - type: ConfigChange
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: file-service-files
  spec:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 1Gi
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    labels:
      app: file-service
    name: file-service
  spec:
    replicas: 1
    selector:
      app: file-service
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          app: file-service
      spec:
        volumes:
        - name: file-volume
          persistentVolumeClaim:
            claimName: file-service-files
        containers:
        - env:
            - name: NPM_RUN
              value: 'service'
            - name: KEYCLOAK_ROOT_URL
              value: ''
            - name: KEYCLOAK_REALM
              value: ''
            - name: MONGO_DB
              valueFrom:
                secretKeyRef:
                  key: database_name
                  name: ''
            - name: MONGO_USER
              valueFrom:
                secretKeyRef:
                  key: username
                  name: ''
            - name: MONGO_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: ''
            - name: MONGO_URI
              valueFrom:
                secretKeyRef:
                  key: uri
                  name: ''
            - name: AMQP_USER
              valueFrom:
                secretKeyRef:
                  key: username
                  name: ''
            - name: AMQP_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: ''
            - name: AMQP_HOST
              valueFrom:
                secretKeyRef:
                  key: host
                  name: ''
            - name: LOG_LEVEL
              value: info
            - name: PORT
              value: '3333'
          image: file-service
          imagePullPolicy: IfNotPresent
          name: file-service
          ports:
          - containerPort: 3333
            name: http
            protocol: TCP
          volumeMounts:
          - mountPath: /data/files
            name: file-volume
    triggers:
      - type: ConfigChange
      - type: ImageChange
        imageChangeParams:
          automatic: true
          containerNames:
            - file-service
          from:
            kind: ImageStreamTag
            name: file-service:latest
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app: file-service
    name: file-service
  spec:
    ports:
    - name: http
      port: 3333
      targetPort: 3333
    selector:
      app: file-service
- apiVersion: v1
  kind: Route
  metadata:
    labels:
      app: file-service
    name: file-service
  spec:
    port:
      targetPort: http
    tls:
      termination: edge
    to:
      kind: Service
      name: file-service
