"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.instrumentAxios = void 0;
const axios_1 = require("axios");
function instrumentAxios(logger) {
    const timings = new Map();
    axios_1.default.interceptors.request.use(function (config) {
        timings.set(config, process.hrtime());
        return config;
    });
    axios_1.default.interceptors.response.use(function (response) {
        var _a;
        const config = response === null || response === void 0 ? void 0 : response.config;
        if (config) {
            const start = timings.get(config);
            if (start) {
                timings.delete(config);
                const [sec, nano] = process.hrtime(start);
                const duration = Math.round(sec * 1e3 + nano * 1e-6);
                const trace = (_a = config.headers) === null || _a === void 0 ? void 0 : _a.get('traceparent');
                logger.debug(`Timing for request to ${config.url}: ${duration} ms`, { context: 'Instrumentation', trace });
            }
        }
        return response;
    });
}
exports.instrumentAxios = instrumentAxios;
//# sourceMappingURL=instrument.js.map