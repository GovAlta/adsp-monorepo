"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTenantHandler = void 0;
const tslib_1 = require("tslib");
const metrics_1 = require("../metrics");
const utils_1 = require("../utils");
const createTenantHandler = (service) => (req, _res, next) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    var _a, _b;
    const end = (0, metrics_1.startBenchmark)(req, 'get-tenant-time');
    const { tenantId: tenantIdValue } = req.query;
    const tenantId = ((_a = req.user) === null || _a === void 0 ? void 0 : _a.isCore) && tenantIdValue ? utils_1.AdspId.parse(tenantIdValue) : (_b = req.user) === null || _b === void 0 ? void 0 : _b.tenantId;
    if (tenantId) {
        try {
            const tenant = yield service.getTenant(tenantId);
            req.tenant = tenant;
        }
        catch (err) {
            next(err);
            return;
        }
    }
    end();
    next();
});
exports.createTenantHandler = createTenantHandler;
//# sourceMappingURL=tenantHandler.js.map