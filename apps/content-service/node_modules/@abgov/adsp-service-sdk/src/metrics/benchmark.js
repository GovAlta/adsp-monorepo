"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startBenchmark = exports.benchmark = void 0;
const types_1 = require("./types");
function benchmark(req, metric, value) {
    const benchmark = req[types_1.REQ_BENCHMARK];
    if (benchmark) {
        // Record the value if this is just setting it; otherwise calculate timings.
        if (value) {
            benchmark.metrics[metric] = value;
        }
        else {
            const startAt = benchmark.timings[metric];
            if (startAt) {
                const [sec, nano] = process.hrtime(startAt);
                benchmark.metrics[metric] = sec * 1e3 + nano * 1e-6;
            }
            else {
                benchmark.timings[metric] = process.hrtime();
            }
        }
    }
}
exports.benchmark = benchmark;
function startBenchmark(req, metric) {
    const benchmark = req[types_1.REQ_BENCHMARK];
    if (benchmark) {
        const startAt = process.hrtime();
        return () => {
            const [sec, nano] = process.hrtime(startAt);
            const value = sec * 1e3 + nano * 1e-6;
            benchmark.metrics[metric] = (benchmark.metrics[metric] || 0) + value;
        };
    }
    else {
        return () => {
            // return a no-op in case there is no benchmark context.
        };
    }
}
exports.startBenchmark = startBenchmark;
//# sourceMappingURL=benchmark.js.map