"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTenantConfigurationHandler = exports.createConfigurationHandler = void 0;
const tslib_1 = require("tslib");
const metrics_1 = require("../metrics");
const createConfigurationHandler = (tokenProvider, service, serviceId) => (req, _res, next) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    var _a, _b;
    const contextTenantId = ((_a = req.tenant) === null || _a === void 0 ? void 0 : _a.id) || ((_b = req.user) === null || _b === void 0 ? void 0 : _b.tenantId);
    req.getConfiguration = (tenantId) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const end = (0, metrics_1.startBenchmark)(req, 'get-configuration-time');
        const token = yield tokenProvider.getAccessToken();
        const config = yield service.getConfiguration(serviceId, token, tenantId || contextTenantId);
        end();
        return config;
    });
    req.getServiceConfiguration = (name, tenantId) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const end = (0, metrics_1.startBenchmark)(req, 'get-configuration-time');
        const config = yield service.getServiceConfiguration(name, tenantId || contextTenantId);
        end();
        return config;
    });
    next();
});
exports.createConfigurationHandler = createConfigurationHandler;
const createTenantConfigurationHandler = (tokenProvider, service, serviceId, tenantId) => (req, _res, next) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    req.getConfiguration = () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const end = (0, metrics_1.startBenchmark)(req, 'get-configuration-time');
        const token = yield tokenProvider.getAccessToken();
        const config = yield service.getConfiguration(serviceId, token, tenantId);
        end();
        return config;
    });
    req.getServiceConfiguration = (name) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const end = (0, metrics_1.startBenchmark)(req, 'get-configuration-time');
        const config = yield service.getServiceConfiguration(name, tenantId);
        end();
        return config;
    });
    next();
});
exports.createTenantConfigurationHandler = createTenantConfigurationHandler;
//# sourceMappingURL=configurationHandler.js.map