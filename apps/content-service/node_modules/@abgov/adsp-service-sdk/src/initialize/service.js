"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initializeService = void 0;
const tslib_1 = require("tslib");
const configurationHandler_1 = require("../configuration/configurationHandler");
const metrics_1 = require("../metrics");
const platform_1 = require("./platform");
/**
 * initializeService
 *
 * Initializes ADSP SDK capabilities for a tenant specific service.
 * @export
 * @param {Options} options
 * @param {(Logger | LogOptions)} logOptions
 * @returns {Promise<Capabilities>}
 */
function initializeService(options, logOptions) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const { directory, configurationService, eventService, tokenProvider, coreStrategy, tenantService, tenantStrategy, healthCheck, clearCached, traceHandler, logger, } = yield (0, platform_1.initializePlatform)(Object.assign({}, options), logOptions);
        // In the case of a tenant service, it will only have access to one tenant (its own).
        const [tenant] = yield tenantService.getTenants();
        const configurationHandler = (0, configurationHandler_1.createTenantConfigurationHandler)(tokenProvider, configurationService, options.serviceId, tenant === null || tenant === void 0 ? void 0 : tenant.id);
        const metricsHandler = yield (0, metrics_1.createMetricsHandler)(options.serviceId, logger, tokenProvider, directory, tenant === null || tenant === void 0 ? void 0 : tenant.id);
        return {
            directory,
            configurationService,
            eventService,
            tokenProvider,
            configurationHandler,
            coreStrategy,
            tenantStrategy,
            healthCheck,
            metricsHandler,
            traceHandler,
            logger,
            clearCached: (serviceId) => clearCached(tenant === null || tenant === void 0 ? void 0 : tenant.id, serviceId),
        };
    });
}
exports.initializeService = initializeService;
//# sourceMappingURL=service.js.map