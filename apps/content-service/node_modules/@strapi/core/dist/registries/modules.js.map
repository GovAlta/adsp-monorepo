{"version":3,"file":"modules.js","sources":["../../src/registries/modules.ts"],"sourcesContent":["import { pickBy, has } from 'lodash/fp';\nimport type { Core } from '@strapi/types';\nimport { createModule, RawModule, Module } from '../domain/module';\n\ntype ModuleMap = { [namespace: string]: Module };\n\nconst modulesRegistry = (strapi: Core.Strapi) => {\n  const modules: ModuleMap = {};\n\n  return {\n    get(namespace: string) {\n      return modules[namespace];\n    },\n    getAll(prefix = '') {\n      return pickBy<ModuleMap>((mod, namespace) => namespace.startsWith(prefix))(modules);\n    },\n    add(namespace: string, rawModule: RawModule) {\n      if (has(namespace, modules)) {\n        throw new Error(`Module ${namespace} has already been registered.`);\n      }\n\n      modules[namespace] = createModule(namespace, rawModule, strapi);\n      modules[namespace].load();\n\n      return modules[namespace];\n    },\n    async bootstrap() {\n      for (const mod of Object.values(modules)) {\n        await mod.bootstrap();\n      }\n    },\n    async register() {\n      for (const mod of Object.values(modules)) {\n        await mod.register();\n      }\n    },\n    async destroy() {\n      for (const mod of Object.values(modules)) {\n        await mod.destroy();\n      }\n    },\n  };\n};\n\nexport default modulesRegistry;\n"],"names":["modulesRegistry","strapi","modules","get","namespace","getAll","prefix","pickBy","mod","startsWith","add","rawModule","has","Error","createModule","load","bootstrap","Object","values","register","destroy"],"mappings":";;;;;AAMA,MAAMA,kBAAkB,CAACC,MAAAA,GAAAA;AACvB,IAAA,MAAMC,UAAqB,EAAC;IAE5B,OAAO;AACLC,QAAAA,GAAAA,CAAAA,CAAIC,SAAiB,EAAA;YACnB,OAAOF,OAAO,CAACE,SAAU,CAAA;AAC3B,SAAA;AACAC,QAAAA,MAAAA,CAAAA,CAAOC,SAAS,EAAE,EAAA;AAChB,YAAA,OAAOC,UAAkB,CAACC,GAAAA,EAAKJ,YAAcA,SAAUK,CAAAA,UAAU,CAACH,MAASJ,CAAAA,CAAAA,CAAAA,OAAAA,CAAAA;AAC7E,SAAA;QACAQ,GAAIN,CAAAA,CAAAA,SAAiB,EAAEO,SAAoB,EAAA;YACzC,IAAIC,MAAAA,CAAIR,WAAWF,OAAU,CAAA,EAAA;AAC3B,gBAAA,MAAM,IAAIW,KAAM,CAAA,CAAC,OAAO,EAAET,SAAAA,CAAU,6BAA6B,CAAC,CAAA;AACpE;AAEAF,YAAAA,OAAO,CAACE,SAAAA,CAAU,GAAGU,kBAAAA,CAAaV,WAAWO,SAAWV,EAAAA,MAAAA,CAAAA;YACxDC,OAAO,CAACE,SAAU,CAAA,CAACW,IAAI,EAAA;YAEvB,OAAOb,OAAO,CAACE,SAAU,CAAA;AAC3B,SAAA;QACA,MAAMY,SAAAA,CAAAA,GAAAA;AACJ,YAAA,KAAK,MAAMR,GAAAA,IAAOS,MAAOC,CAAAA,MAAM,CAAChB,OAAU,CAAA,CAAA;AACxC,gBAAA,MAAMM,IAAIQ,SAAS,EAAA;AACrB;AACF,SAAA;QACA,MAAMG,QAAAA,CAAAA,GAAAA;AACJ,YAAA,KAAK,MAAMX,GAAAA,IAAOS,MAAOC,CAAAA,MAAM,CAAChB,OAAU,CAAA,CAAA;AACxC,gBAAA,MAAMM,IAAIW,QAAQ,EAAA;AACpB;AACF,SAAA;QACA,MAAMC,OAAAA,CAAAA,GAAAA;AACJ,YAAA,KAAK,MAAMZ,GAAAA,IAAOS,MAAOC,CAAAA,MAAM,CAAChB,OAAU,CAAA,CAAA;AACxC,gBAAA,MAAMM,IAAIY,OAAO,EAAA;AACnB;AACF;AACF,KAAA;AACF;;;;"}