{"version":3,"file":"admin.js","sources":["../../src/loaders/admin.ts"],"sourcesContent":["import _ from 'lodash';\nimport type { Core, Struct } from '@strapi/types';\nimport { getGlobalId } from '../domain/content-type';\n\nexport default async function loadAdmin(strapi: Core.Strapi) {\n  strapi.get('services').add(`admin::`, strapi.admin?.services);\n  strapi.get('controllers').add(`admin::`, strapi.admin?.controllers);\n  strapi.get('content-types').add(`admin::`, formatContentTypes(strapi.admin?.contentTypes ?? {}));\n  strapi.get('policies').add(`admin::`, strapi.admin?.policies);\n  strapi.get('middlewares').add(`admin::`, strapi.admin?.middlewares);\n\n  const userAdminConfig = strapi.config.get('admin');\n  strapi.get('config').set('admin', _.merge(strapi.admin?.config, userAdminConfig));\n}\n\nconst formatContentTypes = (contentTypes: Record<string, { schema: Struct.ContentTypeSchema }>) => {\n  Object.values(contentTypes).forEach((definition) => {\n    const { schema } = definition;\n\n    Object.assign(schema, {\n      plugin: 'admin',\n      globalId: getGlobalId(schema, 'admin'),\n    });\n  });\n\n  return contentTypes;\n};\n"],"names":["loadAdmin","strapi","get","add","admin","services","controllers","formatContentTypes","contentTypes","policies","middlewares","userAdminConfig","config","set","_","merge","Object","values","forEach","definition","schema","assign","plugin","globalId","getGlobalId"],"mappings":";;;;;AAIe,eAAeA,UAAUC,MAAmB,EAAA;IACzDA,MAAOC,CAAAA,GAAG,CAAC,UAAA,CAAA,CAAYC,GAAG,CAAC,CAAC,OAAO,CAAC,EAAEF,MAAOG,CAAAA,KAAK,EAAEC,QAAAA,CAAAA;IACpDJ,MAAOC,CAAAA,GAAG,CAAC,aAAA,CAAA,CAAeC,GAAG,CAAC,CAAC,OAAO,CAAC,EAAEF,MAAOG,CAAAA,KAAK,EAAEE,WAAAA,CAAAA;AACvDL,IAAAA,MAAAA,CAAOC,GAAG,CAAC,eAAiBC,CAAAA,CAAAA,GAAG,CAAC,CAAC,OAAO,CAAC,EAAEI,kBAAmBN,CAAAA,MAAAA,CAAOG,KAAK,EAAEI,gBAAgB,EAAC,CAAA,CAAA;IAC7FP,MAAOC,CAAAA,GAAG,CAAC,UAAA,CAAA,CAAYC,GAAG,CAAC,CAAC,OAAO,CAAC,EAAEF,MAAOG,CAAAA,KAAK,EAAEK,QAAAA,CAAAA;IACpDR,MAAOC,CAAAA,GAAG,CAAC,aAAA,CAAA,CAAeC,GAAG,CAAC,CAAC,OAAO,CAAC,EAAEF,MAAOG,CAAAA,KAAK,EAAEM,WAAAA,CAAAA;AAEvD,IAAA,MAAMC,eAAkBV,GAAAA,MAAAA,CAAOW,MAAM,CAACV,GAAG,CAAC,OAAA,CAAA;AAC1CD,IAAAA,MAAAA,CAAOC,GAAG,CAAC,QAAUW,CAAAA,CAAAA,GAAG,CAAC,OAAA,EAASC,CAAEC,CAAAA,KAAK,CAACd,MAAAA,CAAOG,KAAK,EAAEQ,MAAQD,EAAAA,eAAAA,CAAAA,CAAAA;AAClE;AAEA,MAAMJ,qBAAqB,CAACC,YAAAA,GAAAA;AAC1BQ,IAAAA,MAAAA,CAAOC,MAAM,CAACT,YAAcU,CAAAA,CAAAA,OAAO,CAAC,CAACC,UAAAA,GAAAA;QACnC,MAAM,EAAEC,MAAM,EAAE,GAAGD,UAAAA;QAEnBH,MAAOK,CAAAA,MAAM,CAACD,MAAQ,EAAA;YACpBE,MAAQ,EAAA,OAAA;AACRC,YAAAA,QAAAA,EAAUC,kBAAYJ,MAAQ,EAAA,OAAA;AAChC,SAAA,CAAA;AACF,KAAA,CAAA;IAEA,OAAOZ,YAAAA;AACT,CAAA;;;;"}