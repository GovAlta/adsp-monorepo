{"version":3,"file":"src-index.mjs","sources":["../../src/loaders/src-index.ts"],"sourcesContent":["import { resolve } from 'path';\nimport { statSync, existsSync } from 'fs';\nimport { yup, importDefault } from '@strapi/utils';\n\nimport type { Core } from '@strapi/types';\n\nconst srcSchema = yup\n  .object()\n  .shape({\n    bootstrap: yup.mixed().isFunction(),\n    register: yup.mixed().isFunction(),\n    destroy: yup.mixed().isFunction(),\n  })\n  .noUnknown();\n\nconst validateSrcIndex = (srcIndex: unknown) => {\n  return srcSchema.validateSync(srcIndex, { strict: true, abortEarly: false });\n};\n\nexport default (strapi: Core.Strapi) => {\n  if (!existsSync(strapi.dirs.dist.src)) {\n    return;\n  }\n\n  const pathToSrcIndex = resolve(strapi.dirs.dist.src, 'index.js');\n  if (!existsSync(pathToSrcIndex) || statSync(pathToSrcIndex).isDirectory()) {\n    return {};\n  }\n\n  const srcIndex = importDefault(pathToSrcIndex);\n\n  try {\n    validateSrcIndex(srcIndex);\n  } catch (e) {\n    if (e instanceof yup.ValidationError) {\n      strapi.stopWithError({ message: `Invalid file \\`./src/index.js\\`: ${e.message}` });\n    }\n\n    throw e;\n  }\n\n  strapi.app = srcIndex;\n};\n"],"names":["srcSchema","yup","object","shape","bootstrap","mixed","isFunction","register","destroy","noUnknown","validateSrcIndex","srcIndex","validateSync","strict","abortEarly","strapi","existsSync","dirs","dist","src","pathToSrcIndex","resolve","statSync","isDirectory","importDefault","e","ValidationError","stopWithError","message","app"],"mappings":";;;;AAMA,MAAMA,SAAYC,GAAAA,GAAAA,CACfC,MAAM,EAAA,CACNC,KAAK,CAAC;IACLC,SAAWH,EAAAA,GAAAA,CAAII,KAAK,EAAA,CAAGC,UAAU,EAAA;IACjCC,QAAUN,EAAAA,GAAAA,CAAII,KAAK,EAAA,CAAGC,UAAU,EAAA;IAChCE,OAASP,EAAAA,GAAAA,CAAII,KAAK,EAAA,CAAGC,UAAU;AACjC,CAAA,CAAA,CACCG,SAAS,EAAA;AAEZ,MAAMC,mBAAmB,CAACC,QAAAA,GAAAA;IACxB,OAAOX,SAAAA,CAAUY,YAAY,CAACD,QAAU,EAAA;QAAEE,MAAQ,EAAA,IAAA;QAAMC,UAAY,EAAA;AAAM,KAAA,CAAA;AAC5E,CAAA;AAEA,mBAAe,CAAA,CAACC,MAAAA,GAAAA;IACd,IAAI,CAACC,WAAWD,MAAOE,CAAAA,IAAI,CAACC,IAAI,CAACC,GAAG,CAAG,EAAA;AACrC,QAAA;AACF;IAEA,MAAMC,cAAAA,GAAiBC,QAAQN,MAAOE,CAAAA,IAAI,CAACC,IAAI,CAACC,GAAG,EAAE,UAAA,CAAA;AACrD,IAAA,IAAI,CAACH,UAAWI,CAAAA,cAAAA,CAAAA,IAAmBE,QAASF,CAAAA,cAAAA,CAAAA,CAAgBG,WAAW,EAAI,EAAA;AACzE,QAAA,OAAO,EAAC;AACV;AAEA,IAAA,MAAMZ,WAAWa,aAAcJ,CAAAA,cAAAA,CAAAA;IAE/B,IAAI;QACFV,gBAAiBC,CAAAA,QAAAA,CAAAA;AACnB,KAAA,CAAE,OAAOc,CAAG,EAAA;QACV,IAAIA,CAAAA,YAAaxB,GAAIyB,CAAAA,eAAe,EAAE;AACpCX,YAAAA,MAAAA,CAAOY,aAAa,CAAC;AAAEC,gBAAAA,OAAAA,EAAS,CAAC,iCAAiC,EAAEH,CAAEG,CAAAA,OAAO,CAAC;AAAE,aAAA,CAAA;AAClF;QAEA,MAAMH,CAAAA;AACR;AAEAV,IAAAA,MAAAA,CAAOc,GAAG,GAAGlB,QAAAA;AACf,CAAA;;;;"}