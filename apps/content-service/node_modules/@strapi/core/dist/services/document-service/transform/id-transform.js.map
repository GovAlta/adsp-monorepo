{"version":3,"file":"id-transform.js","sources":["../../../../src/services/document-service/transform/id-transform.ts"],"sourcesContent":["import { curry } from 'lodash/fp';\n\nimport type { UID, Modules } from '@strapi/types';\n\nimport { transformData } from './data';\nimport { transformFields } from './fields';\nimport { transformPopulate } from './populate';\n\n/**\n * Transform input of a query to map document ids to entity ids.\n */\nasync function transformParamsDocumentId(\n  uid: UID.Schema,\n  query: Modules.Documents.Params.All\n): Promise<Modules.Documents.Params.All> {\n  // Transform relational documentIds to entity ids\n  let data = query.data;\n  if (query.data) {\n    data = await transformData(query.data, {\n      locale: query.locale,\n      status: query.status,\n      uid,\n    });\n  }\n\n  // Make sure documentId is always present in the response\n  let fields = query.fields;\n  if (query.fields) {\n    fields = transformFields(query.fields) as typeof query.fields;\n  }\n\n  let populate = query.populate;\n  if (query.populate) {\n    populate = (await transformPopulate(query.populate, { uid })) as typeof query.populate;\n  }\n\n  return {\n    ...query,\n    data,\n    fields,\n    populate,\n  };\n}\n\nconst curriedTransformParamsDocumentId = curry(transformParamsDocumentId);\n\nexport { curriedTransformParamsDocumentId as transformParamsDocumentId };\n"],"names":["transformParamsDocumentId","uid","query","data","transformData","locale","status","fields","transformFields","populate","transformPopulate","curriedTransformParamsDocumentId","curry"],"mappings":";;;;;;;AAQA;;AAEC,IACD,eAAeA,yBAAAA,CACbC,GAAe,EACfC,KAAmC,EAAA;;IAGnC,IAAIC,MAAAA,GAAOD,MAAMC,IAAI;IACrB,IAAID,KAAAA,CAAMC,IAAI,EAAE;AACdA,QAAAA,MAAAA,GAAO,MAAMC,kBAAAA,CAAcF,KAAMC,CAAAA,IAAI,EAAE;AACrCE,YAAAA,MAAAA,EAAQH,MAAMG,MAAM;AACpBC,YAAAA,MAAAA,EAAQJ,MAAMI,MAAM;AACpBL,YAAAA;AACF,SAAA,CAAA;AACF;;IAGA,IAAIM,QAAAA,GAASL,MAAMK,MAAM;IACzB,IAAIL,KAAAA,CAAMK,MAAM,EAAE;QAChBA,QAASC,GAAAA,sBAAAA,CAAgBN,MAAMK,MAAM,CAAA;AACvC;IAEA,IAAIE,UAAAA,GAAWP,MAAMO,QAAQ;IAC7B,IAAIP,KAAAA,CAAMO,QAAQ,EAAE;AAClBA,QAAAA,UAAAA,GAAY,MAAMC,0BAAAA,CAAkBR,KAAMO,CAAAA,QAAQ,EAAE;AAAER,YAAAA;AAAI,SAAA,CAAA;AAC5D;IAEA,OAAO;AACL,QAAA,GAAGC,KAAK;AACRC,cAAAA,MAAAA;AACAI,gBAAAA,QAAAA;AACAE,kBAAAA;AACF,KAAA;AACF;AAEA,MAAME,mCAAmCC,QAAMZ,CAAAA,yBAAAA;;;;"}