{"version":3,"file":"render.mjs","sources":["../../../../admin/src/render.ts"],"sourcesContent":["/* eslint-disable no-undef */\nimport { createRoot } from 'react-dom/client';\n\nimport { StrapiApp, StrapiAppConstructorArgs } from './StrapiApp';\nimport { getFetchClient } from './utils/getFetchClient';\nimport { createAbsoluteUrl } from './utils/urls';\n\nimport type { Modules } from '@strapi/types';\n\ninterface RenderAdminArgs {\n  customisations: {\n    register?: (app: StrapiApp) => Promise<void> | void;\n    bootstrap?: (app: StrapiApp) => Promise<void> | void;\n    config?: StrapiAppConstructorArgs['config'];\n  };\n  plugins: StrapiAppConstructorArgs['appPlugins'];\n  features?: Modules.Features.FeaturesService['config'];\n}\n\nconst renderAdmin = async (\n  mountNode: HTMLElement | null,\n  { plugins, customisations, features }: RenderAdminArgs\n) => {\n  if (!mountNode) {\n    throw new Error('[@strapi/admin]: Could not find the root element to mount the admin app');\n  }\n\n  window.strapi = {\n    /**\n     * This ENV variable is passed from the strapi instance, by default no url is set\n     * in the config and therefore the instance returns you an empty string so URLs are relative.\n     *\n     * To ensure that the backendURL is always set, we use the window.location.origin as a fallback.\n     */\n    backendURL: createAbsoluteUrl(process.env.STRAPI_ADMIN_BACKEND_URL),\n    isEE: false,\n    isTrial: false,\n    telemetryDisabled: process.env.STRAPI_TELEMETRY_DISABLED === 'true',\n    future: {\n      isEnabled: (name: keyof NonNullable<Modules.Features.FeaturesConfig['future']>) => {\n        return features?.future?.[name] === true;\n      },\n    },\n    // @ts-expect-error â€“ there's pollution from the global scope of Node.\n    features: {\n      SSO: 'sso',\n      AUDIT_LOGS: 'audit-logs',\n      REVIEW_WORKFLOWS: 'review-workflows',\n      /**\n       * If we don't get the license then we know it's not EE\n       * so no feature is enabled.\n       */\n      isEnabled: () => false,\n    },\n    projectType: 'Community',\n    flags: {\n      nps: false,\n      promoteEE: true,\n    },\n    ai: {\n      enabled: true,\n    },\n  };\n\n  const { get } = getFetchClient();\n\n  interface ProjectType extends Pick<Window['strapi'], 'flags'> {\n    isEE: boolean;\n    isTrial: boolean;\n    features: {\n      name: string;\n    }[];\n    ai: {\n      enabled: boolean;\n    };\n  }\n\n  try {\n    const {\n      data: {\n        data: { isEE, isTrial, features, flags, ai },\n      },\n    } = await get<{ data: ProjectType }>('/admin/project-type');\n\n    window.strapi.isEE = isEE;\n    window.strapi.isTrialLicense = isTrial;\n    window.strapi.flags = flags;\n    window.strapi.features = {\n      ...window.strapi.features,\n      isEnabled: (featureName) => features.some((feature) => feature.name === featureName),\n    };\n    window.strapi.projectType = isEE ? 'Enterprise' : 'Community';\n    window.strapi.aiLicenseKey = process.env.STRAPI_ADMIN_AI_API_KEY;\n    window.strapi.ai = ai;\n  } catch (err) {\n    /**\n     * If this fails, we simply don't activate any EE features.\n     * Should we warn clearer in the UI?\n     */\n    console.error(err);\n  }\n\n  const app = new StrapiApp({\n    config: customisations?.config,\n    appPlugins: plugins,\n  });\n\n  await app.register(customisations?.register);\n  await app.bootstrap(customisations?.bootstrap);\n  await app.loadTrads(customisations?.config?.translations);\n\n  createRoot(mountNode).render(app.render());\n\n  if (\n    typeof module !== 'undefined' &&\n    module &&\n    'hot' in module &&\n    typeof module.hot === 'object' &&\n    module.hot !== null &&\n    'accept' in module.hot &&\n    typeof module.hot.accept === 'function'\n  ) {\n    module.hot.accept();\n  }\n\n  if (typeof import.meta.hot?.accept === 'function') {\n    import.meta.hot.accept();\n  }\n};\n\nexport { renderAdmin };\nexport type { RenderAdminArgs };\n"],"names":["renderAdmin","mountNode","plugins","customisations","features","Error","window","strapi","backendURL","createAbsoluteUrl","process","env","STRAPI_ADMIN_BACKEND_URL","isEE","isTrial","telemetryDisabled","STRAPI_TELEMETRY_DISABLED","future","isEnabled","name","SSO","AUDIT_LOGS","REVIEW_WORKFLOWS","projectType","flags","nps","promoteEE","ai","enabled","get","getFetchClient","data","isTrialLicense","featureName","some","feature","aiLicenseKey","STRAPI_ADMIN_AI_API_KEY","err","console","error","app","StrapiApp","config","appPlugins","register","bootstrap","loadTrads","translations","createRoot","render","module","hot","accept"],"mappings":"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"}