{"version":3,"file":"normalizeAPIError.mjs","sources":["../../../../../admin/src/utils/normalizeAPIError.ts"],"sourcesContent":["import { getPrefixedId } from './getPrefixedId';\n\nimport type { ApiError } from '../hooks/useAPIErrorHandler';\nimport type { FetchError } from '../utils/getFetchClient';\nimport type { errors } from '@strapi/utils';\n\nexport interface NormalizeErrorOptions {\n  name?: string;\n  intlMessagePrefixCallback?: (id: string) => string;\n}\n\ninterface NormalizeErrorReturn {\n  id: string;\n  defaultMessage: string;\n  name?: string;\n  values: Record<'path', string> | Record<string, never>;\n}\n\ninterface YupFormattedError {\n  path: string[];\n  message: string;\n  name: string;\n  value: string;\n}\n\nfunction normalizeError(\n  error: ApiError | YupFormattedError,\n  { name, intlMessagePrefixCallback }: NormalizeErrorOptions\n): NormalizeErrorReturn {\n  const { message } = error;\n\n  const normalizedError = {\n    id: getPrefixedId(message, intlMessagePrefixCallback),\n    defaultMessage: message,\n    name: error.name ?? name,\n    values: {},\n  };\n\n  if ('path' in error) {\n    normalizedError.values = { path: error.path.join('.') };\n  }\n\n  return normalizedError;\n}\n\nconst validateErrorIsYupValidationError = (\n  err: ApiError\n): err is errors.YupValidationError & { details: { errors: YupFormattedError[] } } =>\n  typeof err.details === 'object' && err.details !== null && 'errors' in err.details;\n\n/**\n * Normalize the format of `ResponseError`\n * in places where the hook `useAPIErrorHandler` can not called\n * (e.g. outside of a React component).\n */\nexport function normalizeAPIError(\n  apiError: FetchError,\n  intlMessagePrefixCallback?: NormalizeErrorOptions['intlMessagePrefixCallback']\n):\n  | NormalizeErrorReturn\n  | { name: string; message: string | null; errors: NormalizeErrorReturn[] }\n  | null {\n  const error = apiError.response?.data?.error;\n\n  if (error) {\n    // some errors carry multiple errors (such as ValidationError)\n    if (validateErrorIsYupValidationError(error)) {\n      return {\n        name: error.name,\n        message: error?.message || null,\n        errors: error.details.errors.map((err) =>\n          normalizeError(err, { name: error.name, intlMessagePrefixCallback })\n        ),\n      };\n    }\n    return normalizeError(error, { intlMessagePrefixCallback });\n  }\n\n  return null;\n}\n"],"names":["normalizeError","error","name","intlMessagePrefixCallback","message","normalizedError","id","getPrefixedId","defaultMessage","values","path","join","validateErrorIsYupValidationError","err","details","normalizeAPIError","apiError","response","data","errors","map"],"mappings":";;AAyBA,SAASA,eACPC,KAAmC,EACnC,EAAEC,IAAI,EAAEC,yBAAyB,EAAyB,EAAA;IAE1D,MAAM,EAAEC,OAAO,EAAE,GAAGH,KAAAA;AAEpB,IAAA,MAAMI,eAAkB,GAAA;AACtBC,QAAAA,EAAAA,EAAIC,cAAcH,OAASD,EAAAA,yBAAAA,CAAAA;QAC3BK,cAAgBJ,EAAAA,OAAAA;QAChBF,IAAMD,EAAAA,KAAAA,CAAMC,IAAI,IAAIA,IAAAA;AACpBO,QAAAA,MAAAA,EAAQ;AACV,KAAA;AAEA,IAAA,IAAI,UAAUR,KAAO,EAAA;AACnBI,QAAAA,eAAAA,CAAgBI,MAAM,GAAG;AAAEC,YAAAA,IAAAA,EAAMT,KAAMS,CAAAA,IAAI,CAACC,IAAI,CAAC,GAAA;AAAK,SAAA;AACxD;IAEA,OAAON,eAAAA;AACT;AAEA,MAAMO,iCAAoC,GAAA,CACxCC,GAEA,GAAA,OAAOA,IAAIC,OAAO,KAAK,QAAYD,IAAAA,GAAAA,CAAIC,OAAO,KAAK,IAAQ,IAAA,QAAA,IAAYD,IAAIC,OAAO;AAEpF;;;;AAIC,IACM,SAASC,iBACdC,CAAAA,QAAoB,EACpBb,yBAA8E,EAAA;AAK9E,IAAA,MAAMF,KAAQe,GAAAA,QAAAA,CAASC,QAAQ,EAAEC,IAAMjB,EAAAA,KAAAA;AAEvC,IAAA,IAAIA,KAAO,EAAA;;AAET,QAAA,IAAIW,kCAAkCX,KAAQ,CAAA,EAAA;YAC5C,OAAO;AACLC,gBAAAA,IAAAA,EAAMD,MAAMC,IAAI;AAChBE,gBAAAA,OAAAA,EAASH,OAAOG,OAAW,IAAA,IAAA;gBAC3Be,MAAQlB,EAAAA,KAAAA,CAAMa,OAAO,CAACK,MAAM,CAACC,GAAG,CAAC,CAACP,GAChCb,GAAAA,cAAAA,CAAea,GAAK,EAAA;AAAEX,wBAAAA,IAAAA,EAAMD,MAAMC,IAAI;AAAEC,wBAAAA;AAA0B,qBAAA,CAAA;AAEtE,aAAA;AACF;AACA,QAAA,OAAOH,eAAeC,KAAO,EAAA;AAAEE,YAAAA;AAA0B,SAAA,CAAA;AAC3D;IAEA,OAAO,IAAA;AACT;;;;"}