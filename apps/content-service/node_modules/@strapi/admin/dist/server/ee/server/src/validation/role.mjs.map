{"version":3,"file":"role.mjs","sources":["../../../../../../ee/server/src/validation/role.ts"],"sourcesContent":["import { yup, validateYupSchema } from '@strapi/utils';\n\nconst roleCreateSchema = yup\n  .object()\n  .shape({\n    name: yup.string().min(1).required(),\n    description: yup.string().nullable(),\n  })\n  .noUnknown();\n\nconst rolesDeleteSchema = yup\n  .object()\n  .shape({\n    ids: yup\n      .array()\n      .of(yup.strapiID())\n      .min(1)\n      .required()\n      .test(\n        'roles-deletion-checks',\n        'Roles deletion checks have failed',\n        async function rolesDeletionChecks(ids) {\n          try {\n            await strapi.service('admin::role').checkRolesIdForDeletion(ids);\n\n            if (strapi.ee.features.isEnabled('sso')) {\n              await strapi.service('admin::role').ssoCheckRolesIdForDeletion(ids);\n            }\n          } catch (e: any) {\n            return this.createError({ path: 'ids', message: e.message });\n          }\n\n          return true;\n        }\n      ),\n  })\n  .noUnknown();\n\nconst roleDeleteSchema = yup\n  .strapiID()\n  .required()\n  .test(\n    'no-admin-single-delete',\n    'Role deletion checks have failed',\n    async function noAdminSingleDelete(id) {\n      try {\n        await strapi.service('admin::role').checkRolesIdForDeletion([id]);\n\n        if (strapi.ee.features.isEnabled('sso')) {\n          await strapi.service('admin::role').ssoCheckRolesIdForDeletion([id]);\n        }\n      } catch (e: any) {\n        return this.createError({ path: 'id', message: e.message });\n      }\n\n      return true;\n    }\n  );\n\nexport const validateRoleCreateInput = validateYupSchema(roleCreateSchema);\nexport const validateRolesDeleteInput = validateYupSchema(rolesDeleteSchema);\nexport const validateRoleDeleteInput = validateYupSchema(roleDeleteSchema);\n\nexport default {\n  validateRoleCreateInput,\n  validateRolesDeleteInput,\n  validateRoleDeleteInput,\n};\n"],"names":["roleCreateSchema","yup","object","shape","name","string","min","required","description","nullable","noUnknown","rolesDeleteSchema","ids","array","of","strapiID","test","rolesDeletionChecks","strapi","service","checkRolesIdForDeletion","ee","features","isEnabled","ssoCheckRolesIdForDeletion","e","createError","path","message","roleDeleteSchema","noAdminSingleDelete","id","validateRoleCreateInput","validateYupSchema","validateRolesDeleteInput","validateRoleDeleteInput"],"mappings":";;AAEA,MAAMA,gBAAmBC,GAAAA,GAAAA,CACtBC,MAAM,EAAA,CACNC,KAAK,CAAC;AACLC,IAAAA,IAAAA,EAAMH,IAAII,MAAM,EAAA,CAAGC,GAAG,CAAC,GAAGC,QAAQ,EAAA;IAClCC,WAAaP,EAAAA,GAAAA,CAAII,MAAM,EAAA,CAAGI,QAAQ;AACpC,CAAA,CAAA,CACCC,SAAS,EAAA;AAEZ,MAAMC,iBAAoBV,GAAAA,GAAAA,CACvBC,MAAM,EAAA,CACNC,KAAK,CAAC;AACLS,IAAAA,GAAAA,EAAKX,IACFY,KAAK,EAAA,CACLC,EAAE,CAACb,GAAAA,CAAIc,QAAQ,EACfT,CAAAA,CAAAA,GAAG,CAAC,CACJC,CAAAA,CAAAA,QAAQ,GACRS,IAAI,CACH,yBACA,mCACA,EAAA,eAAeC,oBAAoBL,GAAG,EAAA;QACpC,IAAI;AACF,YAAA,MAAMM,MAAOC,CAAAA,OAAO,CAAC,aAAA,CAAA,CAAeC,uBAAuB,CAACR,GAAAA,CAAAA;AAE5D,YAAA,IAAIM,OAAOG,EAAE,CAACC,QAAQ,CAACC,SAAS,CAAC,KAAQ,CAAA,EAAA;AACvC,gBAAA,MAAML,MAAOC,CAAAA,OAAO,CAAC,aAAA,CAAA,CAAeK,0BAA0B,CAACZ,GAAAA,CAAAA;AACjE;AACF,SAAA,CAAE,OAAOa,CAAQ,EAAA;YACf,OAAO,IAAI,CAACC,WAAW,CAAC;gBAAEC,IAAM,EAAA,KAAA;AAAOC,gBAAAA,OAAAA,EAASH,EAAEG;AAAQ,aAAA,CAAA;AAC5D;QAEA,OAAO,IAAA;AACT,KAAA;AAEN,CAAA,CAAA,CACClB,SAAS,EAAA;AAEZ,MAAMmB,gBAAmB5B,GAAAA,GAAAA,CACtBc,QAAQ,EAAA,CACRR,QAAQ,EAAA,CACRS,IAAI,CACH,wBACA,EAAA,kCAAA,EACA,eAAec,mBAAAA,CAAoBC,EAAE,EAAA;IACnC,IAAI;AACF,QAAA,MAAMb,MAAOC,CAAAA,OAAO,CAAC,aAAA,CAAA,CAAeC,uBAAuB,CAAC;AAACW,YAAAA;AAAG,SAAA,CAAA;AAEhE,QAAA,IAAIb,OAAOG,EAAE,CAACC,QAAQ,CAACC,SAAS,CAAC,KAAQ,CAAA,EAAA;AACvC,YAAA,MAAML,MAAOC,CAAAA,OAAO,CAAC,aAAA,CAAA,CAAeK,0BAA0B,CAAC;AAACO,gBAAAA;AAAG,aAAA,CAAA;AACrE;AACF,KAAA,CAAE,OAAON,CAAQ,EAAA;QACf,OAAO,IAAI,CAACC,WAAW,CAAC;YAAEC,IAAM,EAAA,IAAA;AAAMC,YAAAA,OAAAA,EAASH,EAAEG;AAAQ,SAAA,CAAA;AAC3D;IAEA,OAAO,IAAA;AACT,CAAA,CAAA;AAGG,MAAMI,uBAA0BC,GAAAA,iBAAAA,CAAkBjC,gBAAkB;AACpE,MAAMkC,wBAA2BD,GAAAA,iBAAAA,CAAkBtB,iBAAmB;AACtE,MAAMwB,uBAA0BF,GAAAA,iBAAAA,CAAkBJ,gBAAkB;;;;"}