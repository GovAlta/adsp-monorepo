import{r as M,a as z,av as Z,aw as K,j as e,b0 as O,C as F,fQ as x,bL as X,bM as V,K as S,Q as g,fR as ee,cF as y,fS as te,M as w,fT as ae,fU as se,G as D,fV as ne,R as ie,U as re,fW as oe,e as E,fX as G,fY as le,y as de,$ as ce,x as ue,u as me,fZ as ge,z as he,f_ as fe,c9 as pe,b as xe,B as je,f$ as be,P as q,e_ as Re,D as N,J as Ce,g0 as Me,g1 as R,g2 as ze,fw as L,g3 as Te,g4 as ye,N as U,aV as Se,cG as ve,V as Le}from"./strapi-CZE0NOhr.js";import{t as we,a as De,R as Ee,z as ke}from"./schemas-dsTsMLKJ.js";import{f as Ie}from"./index-CUG9Dncs.js";import{f as Ae}from"./index-CBGB9l1q.js";function Pe(o,a,m){var s=we(o,m),n=De(a,s,!0),t=new Date(s.getTime()-n),u=new Date(0);return u.setFullYear(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),u.setHours(t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),u}const $e=["years","months","days","hours","minutes","seconds"],Ne=M.forwardRef(({timestamp:o,customIntervals:a=[],...m},s)=>{const{formatRelativeTime:n,formatDate:t,formatTime:u}=z(),r=Z({start:o,end:Date.now()}),h=$e.find(i=>r[i]>0&&Object.keys(r).includes(i)),d=K(o)?-r[h]:r[h],p=a.find(i=>r[i.unit]<i.threshold),j=p?p.text:n(d,h,{numeric:"auto"});return e.jsx("time",{ref:s,dateTime:o.toISOString(),role:"time",title:`${t(o)} ${u(o)}`,...m,children:j})}),Ue=({handleClose:o,open:a,handleSubmit:m,initialValues:s,isLoading:n=!1})=>{const{formatMessage:t}=z(),{pathname:u}=O(),r=u===`/plugins/${oe}`,{timezoneList:h,systemTimezone:d={value:"UTC+00:00-Africa/Abidjan "}}=F(s.scheduledAt?new Date(s.scheduledAt):new Date),p=i=>{const{date:c,time:b,timezone:l}=i;if(!c||!b||!l)return null;const f=l.split("&")[1];return ke(`${c} ${b}`,f)},j=()=>h.find(c=>c.value.split("&")[1]===s.timezone)?.value||d.value;return e.jsx(x.Root,{open:a,onOpenChange:o,children:e.jsxs(x.Content,{children:[e.jsx(x.Header,{children:e.jsx(x.Title,{children:t({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:r})})}),e.jsx(X,{onSubmit:i=>{m({...i,timezone:i.timezone?i.timezone.split("&")[1]:null,scheduledAt:i.isScheduled?p(i):null})},initialValues:{...s,timezone:s.timezone?j():d.value},validationSchema:Ee,validateOnChange:!1,children:({values:i,errors:c,handleChange:b,setFieldValue:l})=>e.jsxs(V,{children:[e.jsx(x.Body,{children:e.jsxs(S,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(g.Root,{name:"name",error:c.name&&t({id:c.name,defaultMessage:c.name}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(ee,{value:i.name,onChange:b}),e.jsx(g.Error,{})]}),e.jsx(y,{width:"max-content",children:e.jsx(te,{name:"isScheduled",checked:i.isScheduled,onCheckedChange:f=>{l("isScheduled",f),f?(l("date",s.date),l("time",s.time),l("timezone",s.timezone??d?.value)):(l("date",null),l("time",""),l("timezone",null))},children:e.jsx(w,{textColor:i.isScheduled?"primary600":"neutral800",fontWeight:i.isScheduled?"semiBold":"regular",children:t({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),i.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{gap:4,alignItems:"start",children:[e.jsx(y,{width:"100%",children:e.jsxs(g.Root,{name:"date",error:c.date&&t({id:c.date,defaultMessage:c.date}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(ae,{onChange:f=>{const v=f?Ie(f,{representation:"date"}):null;l("date",v)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("date",null)},value:i.date?new Date(i.date):new Date,minDate:Pe(new Date,i.timezone.split("&")[1])}),e.jsx(g.Error,{})]})}),e.jsx(y,{width:"100%",children:e.jsxs(g.Root,{name:"time",error:c.time&&t({id:c.time,defaultMessage:c.time}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(se,{onChange:f=>{l("time",f)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("time","")},value:i.time||void 0}),e.jsx(g.Error,{})]})})]}),e.jsx(Be,{timezoneOptions:h})]})]})}),e.jsxs(x.Footer,{children:[e.jsx(x.Close,{children:e.jsx(D,{variant:"tertiary",name:"cancel",children:t({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(D,{name:"submit",loading:n,type:"submit",children:t({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:r})})]})]})})]})})},Be=({timezoneOptions:o})=>{const{values:a,errors:m,setFieldValue:s}=ne(),{formatMessage:n}=z(),[t,u]=M.useState(o);return M.useEffect(()=>{if(a.date){const{timezoneList:r}=F(new Date(a.date));u(r);const h=a.timezone&&r.find(d=>d.value.split("&")[1]===a.timezone.split("&")[1]);h&&s("timezone",h.value)}},[s,a.date,a.timezone]),e.jsxs(g.Root,{name:"timezone",error:m.timezone&&n({id:m.timezone,defaultMessage:m.timezone}),required:!0,children:[e.jsx(g.Label,{children:n({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(ie,{autocomplete:{type:"list",filter:"contains"},value:a.timezone||void 0,textValue:a.timezone?a.timezone.replace(/&/," "):void 0,onChange:r=>{s("timezone",r)},onTextValueChange:r=>{s("timezone",r)},onClear:()=>{s("timezone","")},children:t.map(r=>e.jsx(re,{value:r.value,children:r.value.replace(/&/," ")},r.value))}),e.jsx(g.Error,{})]})},Oe=E(G)`
  display: block;
`,Fe=E(Ne)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,Ge=o=>{let a;switch(o){case"ready":a="success";break;case"blocked":a="warning";break;case"failed":a="danger";break;case"done":a="primary";break;case"empty":default:a="neutral"}return{textColor:`${a}600`,backgroundColor:`${a}100`,borderColor:`${a}200`}},B=({sectionTitle:o,releases:a=[],isError:m=!1})=>{const{formatMessage:s}=z();return m?e.jsx(q.Error,{}):a?.length===0?e.jsx(Te,{content:s({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:o}),icon:e.jsx(ye,{width:"16rem"})}):e.jsx(U.Root,{gap:4,children:a.map(({id:n,name:t,scheduledAt:u,status:r})=>e.jsx(U.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Oe,{tag:Se,to:`${n}`,isExternal:!1,children:e.jsxs(S,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(S,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(w,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:t}),e.jsx(w,{variant:"pi",textColor:"neutral600",children:u?e.jsx(Fe,{timestamp:new Date(u)}):s({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(ve,{...Ge(r),children:r})]})})},n))})},qe=E(le)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,He={name:"",date:Ae(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},Je=()=>{const o=O(),[a,m]=M.useState(!1),{toggleNotification:s}=de(),{formatMessage:n}=z(),t=ce(),{formatAPIError:u}=ue(),[{query:r},h]=me(),d=ge(r),{data:p,isLoading:j}=he(),[i,{isLoading:c}]=fe(),{getFeature:b}=pe(),{maximumReleases:l=3}=b("cms-content-releases"),{trackUsage:f}=xe(),{allowedActions:{canCreate:v}}=je(be),{isLoading:k,isSuccess:H,isError:I}=d,Q=d?.currentData?.meta?.activeTab||"pending";M.useEffect(()=>{o?.state?.errors&&(s({type:"danger",title:n({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:n({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),t("",{replace:!0,state:null}))},[n,o?.state?.errors,t,s]);const A=()=>{m(C=>!C)};if(k||j)return e.jsx(q.Loading,{});const P=H&&d.currentData?.meta?.pendingReleasesCount||0,$=P>=l,W=C=>{h({...r,page:1,pageSize:d?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:C!=="pending"}}})},Y=async({name:C,scheduledAt:_,timezone:J})=>{const T=await i({name:C,scheduledAt:_,timezone:J});"data"in T?(s({type:"success",message:n({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),f("didCreateRelease"),t(T.data.data.id.toString())):Le(T.error)?s({type:"danger",message:u(T.error)}):s({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(Re,{"aria-busy":k||j,children:[e.jsx(N.Header,{title:n({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),secondaryAction:e.jsx(Ce,{label:n({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})}),subtitle:n({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:v?e.jsx(D,{startIcon:e.jsx(Me,{}),onClick:A,disabled:$,children:n({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx(N.Content,{children:e.jsxs(e.Fragment,{children:[$&&e.jsx(qe,{marginBottom:6,action:e.jsx(G,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:n({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:n({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:l}),onClose:()=>{},closeLabel:"",children:n({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(R.Root,{variant:"simple",onValueChange:W,value:Q,children:[e.jsxs(y,{paddingBottom:8,children:[e.jsxs(R.List,{"aria-label":n({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(R.Trigger,{value:"pending",children:n({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:P})}),e.jsx(R.Trigger,{value:"done",children:n({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(ze,{})]}),e.jsx(R.Content,{value:"pending",children:e.jsx(B,{sectionTitle:"pending",releases:d?.currentData?.data,isError:I})}),e.jsx(R.Content,{value:"done",children:e.jsx(B,{sectionTitle:"done",releases:d?.currentData?.data,isError:I})})]}),e.jsxs(L.Root,{...d?.currentData?.meta?.pagination,defaultPageSize:d?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(L.PageSize,{options:["8","16","32","64"]}),e.jsx(L.Links,{})]})]})}),e.jsx(Ue,{open:a,handleClose:A,handleSubmit:Y,isLoading:c,initialValues:{...He,timezone:p?.data.defaultTimezone?p.data.defaultTimezone.split("&")[1]:null}})]})};export{Ne as R,Ue as a,Je as b,Ge as g,Pe as u};
