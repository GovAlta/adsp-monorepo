const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ConfigureTheView-C7dCFnlI.js","strapi-CZE0NOhr.js","strapi-D6821bIJ.css"])))=>i.map(i=>d[i]);
import{jw as Te,j as e,eV as T,jx as xe,eR as c,jy as E,a as M,jz as $e,ic as ue,eS as S,jA as Pe,c3 as Ve,y as Ue,eL as Qe,cP as ze,eN as Oe,i7 as _,jB as Ge,jC as b,eU as $,jD as Ne,bL as _e,bM as We,eX as q,eY as ge,jE as He,eW as K,jF as qe,jk as Xe,r as C,jG as Ke,jH as Ye,jI as Je,jJ as X,b as ye,u as P,jK as fe,jL as Ze,jM as es,jN as pe,jO as ss,b0 as be,D as B,jP as ts,ia as as,aV as ns,ib as os,b2 as Ce,e as Y,$ as is,jQ as rs,jR as ls,jS as ds,jT as cs,jU as us,jV as gs,jW as fs,P as L,jX as ps,jY as W,a9 as hs,jZ as js,j_ as I,j$ as ms,k0 as xs,k1 as ys,k2 as bs,k3 as Cs,k4 as Ms,k5 as Fs,k6 as ks,k7 as Ss,k8 as vs,k9 as Ls,fw as H,ka as ws,kb as Es,kc as As,kd as Rs,i9 as Ds,W as Is,X as he,_ as Bs}from"./strapi-CZE0NOhr.js";import{S as Ts}from"./SearchInput-B9W5BcBG.js";const $s=s=>{const{id:n}=Te();return e.jsx(T,{position:"relative",zIndex:2,children:e.jsx(xe,{"aria-labelledby":`${n}-title`,...s})})},Ps=(s,{pathname:n,query:a})=>{const o=[{id:null,label:{id:c("plugin.name"),defaultMessage:"Media Library"},href:s?E(n,a||{}):void 0}];return s?.parent&&typeof s?.parent!="number"&&s?.parent?.parent&&o.push([]),s?.parent&&typeof s.parent!="number"&&o.push({id:s.parent.id,label:s.parent.name,href:E(n,a||{},{folder:s.parent.id?.toString(),folderPath:s.parent.path})}),s&&o.push({id:s.id,label:s.name}),o},Vs=({selected:s,onSuccess:n})=>{const{formatMessage:a}=M(),{remove:o}=$e(),d=async()=>{await o(s),n()};return e.jsxs(ue.Root,{children:[e.jsx(ue.Trigger,{children:e.jsx(S,{variant:"danger-light",size:"S",startIcon:e.jsx(Pe,{}),children:a({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Ve,{onConfirm:d})]})},Us=()=>{const{formatMessage:s}=M(),{toggleNotification:n}=Ue(),a=Qe(),{post:o}=ze(),i=Oe(({destinationFolderId:p,filesAndFolders:f})=>{const l=f.reduce((g,x)=>{const{id:r,type:k}=x,h=k==="asset"?"fileIds":"folderIds";return g[h]||(g[h]=[]),g[h].push(r),g},{});return o("/upload/actions/bulk-move",{...l,destinationFolderId:p})},{onSuccess(p){const{data:{data:f}}=p;f?.files?.length>0&&(a.refetchQueries([_,"assets"],{active:!0}),a.refetchQueries([_,"asset-count"],{active:!0})),a.refetchQueries([_,"folders"],{active:!0}),n({type:"success",message:s({id:c("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...i,move:(p,f)=>i.mutateAsync({destinationFolderId:p,filesAndFolders:f})}},Qs=({onClose:s,selected:n=[],currentFolder:a})=>{const{formatMessage:o}=M(),{data:d,isLoading:i}=Ge(),{move:u}=Us();if(!d)return null;const p=async(l,{setErrors:g})=>{try{if(typeof l.destination!="string"){const x=l.destination.value;await u(x,n),s()}}catch(x){const r=qe(x);if(r&&"errors"in r){const k=r.errors?.reduce((h,A)=>(h[A.values?.path?.length||"destination"]=A.defaultMessage,h),{});Xe(k)||g(k)}}};if(i)return e.jsx(b.Content,{children:e.jsx(b.Body,{children:e.jsx($,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Ne,{children:o({id:c("content.isLoading"),defaultMessage:"Content is loading."})})})})});const f={destination:{value:a?.id||"",label:a?.name||d[0].label}};return e.jsx(b.Content,{children:e.jsx(_e,{validateOnChange:!1,onSubmit:p,initialValues:f,children:({values:l,errors:g,setFieldValue:x})=>e.jsxs(We,{noValidate:!0,children:[e.jsx(b.Header,{children:e.jsx(b.Title,{children:o({id:c("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(b.Body,{children:e.jsx(q.Root,{gap:4,children:e.jsx(q.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(ge.Root,{id:"folder-destination",children:[e.jsx(ge.Label,{children:o({id:c("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(He,{options:d,onChange:r=>{x("destination",r)},defaultValue:typeof l.destination!="string"?l.destination:void 0,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:g?.destination,ariaErrorMessage:"destination-error"}),g.destination&&e.jsx(K,{variant:"pi",tag:"p",textColor:"danger600",children:g.destination})]})})})}),e.jsxs(b.Footer,{children:[e.jsx(b.Close,{children:e.jsx(S,{variant:"tertiary",name:"cancel",children:o({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(S,{type:"submit",loading:i,children:o({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})},zs=({selected:s=[],onSuccess:n,currentFolder:a})=>{const{formatMessage:o}=M(),[d,i]=C.useState(!1),u=()=>{i(!1),n()};return e.jsxs(b.Root,{open:d,onOpenChange:i,children:[e.jsx(b.Trigger,{children:e.jsx(S,{variant:"secondary",size:"S",startIcon:e.jsx(Ke,{}),children:o({id:"global.move",defaultMessage:"Move"})})}),e.jsx(Qs,{currentFolder:a,onClose:u,selected:s})]})},Os=({selected:s=[],onSuccess:n,currentFolder:a})=>{const{formatMessage:o}=M(),d=s?.reduce(function(i,u){return u?.type==="folder"&&"files"in u&&u?.files&&"count"in u.files?i+u?.files?.count:i+1},0);return e.jsxs($,{gap:2,paddingBottom:5,children:[e.jsx(K,{variant:"epsilon",textColor:"neutral600",children:o({id:c("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:s?.filter(({type:i})=>i==="folder").length,numberAssets:d})}),e.jsx(Vs,{selected:s,onSuccess:n}),e.jsx(zs,{currentFolder:a,selected:s,onSuccess:n})]})},Gs=({isFiltering:s,canCreate:n,canRead:a})=>s?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:a?n?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ns=({canCreate:s,isFiltering:n,canRead:a,onActionClick:o})=>{const{formatMessage:d}=M(),i=Gs({isFiltering:n,canCreate:s,canRead:a});return e.jsx(Ye,{icon:a?void 0:Je,action:s&&!n&&e.jsx(S,{variant:"secondary",startIcon:e.jsx(X,{}),onClick:o,children:d({id:c("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:d({...i,id:c(i.id)})})},_s=()=>{const[s,n]=C.useState(!1),{formatMessage:a}=M(),{trackUsage:o}=ye(),[{query:d},i]=P(),u=d?.filters?.$and||[],p=l=>{i({filters:{$and:l},page:1})},f=l=>{o("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(l[l.length-1])[0]}),i({filters:{$and:l},page:1})};return e.jsxs(fe.Root,{open:s,onOpenChange:n,children:[e.jsx(fe.Trigger,{children:e.jsx(S,{variant:"tertiary",startIcon:e.jsx(Ze,{}),size:"S",children:a({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(es,{displayedFilters:pe,filters:u,onSubmit:f,onToggle:n}),e.jsx(ss,{appliedFilters:u,filtersSchema:pe,onRemoveFilter:p})]})},Ws=({breadcrumbs:s=null,canCreate:n,folder:a=null,onToggleEditFolderDialog:o,onToggleUploadAssetDialog:d})=>{const{formatMessage:i}=M(),{pathname:u}=be(),[{query:p}]=P(),f={...p,folder:a?.parent&&typeof a.parent!="number"&&a.parent.id?a.parent.id:void 0,folderPath:a?.parent&&typeof a.parent!="number"&&a.parent.path?a.parent.path:void 0};return e.jsx(B.Header,{title:i({id:c("plugin.name"),defaultMessage:"Media Library"}),subtitle:s&&typeof s!="boolean"&&a&&e.jsx(ts,{label:i({id:c("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:s,currentFolderId:a?.id}),navigationAction:a&&e.jsx(as,{tag:ns,startIcon:e.jsx(os,{}),to:`${u}?${Ce.stringify(f,{encode:!1})}`,children:i({id:c("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:n&&e.jsxs($,{gap:2,children:[e.jsx(S,{startIcon:e.jsx(X,{}),variant:"secondary",onClick:o,children:i({id:c("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(S,{startIcon:e.jsx(X,{}),onClick:d,children:i({id:c("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})},Hs=Y(T)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,je=Y(K)`
  max-width: 100%;
`,me=Y(T)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }
`,qs=()=>{const s=is(),{canRead:n,canCreate:a,canUpdate:o,canCopyLink:d,canDownload:i,canConfigureView:u,isLoading:p}=rs(),f=C.useRef(),{formatMessage:l}=M(),{pathname:g}=be(),{trackUsage:x}=ye(),[{query:r},k]=P(),h=!!(r._q||r.filters),[A,Me]=ls(Rs.view,I.GRID),v=A===I.GRID,{data:y,isLoading:Fe,error:ke}=ds({skipWhen:!n,query:r}),{data:Se,isLoading:ve,error:Le}=cs({enabled:n&&y?.pagination?.page===1&&!us(r),query:r}),{data:V,isLoading:J,error:we}=gs(r?.folder,{enabled:n&&!!r?.folder});we?.name==="NotFoundError"&&s(g);const R=Se?.map(t=>({...t,type:"folder",folderURL:E(g,r,{folder:t.id.toString(),folderPath:t.path}),isSelectable:o}))??[],j=R?.length||0,D=y?.results?.map(t=>({...t,type:"asset",isSelectable:o}))||[],m=D?.length??0,Ee=y?.pagination?.total,Ae=J||ve||p||Fe,[Z,Re]=C.useState(!1),[ee,se]=C.useState(!1),[U,Q]=C.useState(void 0),[z,te]=C.useState(void 0),[F,{selectOne:O,selectAll:ae}]=fs(["type","id"],[]),ne=F?.length>0&&F?.length!==m+j,G=()=>Re(t=>!t),oe=({created:t=!1}={})=>{t&&r?.page!=="1"&&k({...r,page:1}),se(w=>!w)},ie=(t,w)=>{t&&x("didSelectAllMediaLibraryElements"),ae(w)},re=t=>{x("didSortMediaLibraryElements",{location:"upload",sort:t}),k({sort:t})},le=t=>{te(t),se(!0)},De=t=>{te(null),oe(t),f.current&&f.current.focus()},de=t=>{t===m&&y?.pagination?.page===y?.pagination?.pageCount&&y?.pagination?.page&&y.pagination.page>1&&k({...r,page:y.pagination.page-1})},Ie=()=>{ae(),de(F.length)};return Ae?e.jsx(L.Loading,{}):ke||Le?e.jsx(L.Error,{}):e.jsxs(B.Root,{children:[e.jsxs(L.Main,{children:[e.jsx(Ws,{breadcrumbs:J?null:Ps(V,{pathname:g,query:r}),canCreate:a,onToggleEditFolderDialog:oe,onToggleUploadAssetDialog:G,folder:V}),e.jsx(B.Action,{startActions:e.jsxs(e.Fragment,{children:[o&&v&&(m>0||j>0)&&e.jsx(Hs,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(xe,{"aria-label":l({id:c("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:ne?"indeterminate":(m>0||j>0)&&F.length===m+j,onCheckedChange:t=>ie(t,[...D,...R])})}),n&&v&&e.jsx(ps,{value:r?.sort,onChangeSort:re}),n&&e.jsx(_s,{})]}),endActions:e.jsxs(e.Fragment,{children:[u?e.jsx(me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{tag:hs,to:{pathname:`${g}/configuration`,search:Ce.stringify(r,{encode:!1})},label:l({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(js,{})})}):null,e.jsx(me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{label:l(v?{id:c("view-switch.list"),defaultMessage:"List View"}:{id:c("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>Me(v?I.LIST:I.GRID),children:v?e.jsx(ms,{}):e.jsx(xs,{})})}),e.jsx(Ts,{label:l({id:c("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs(B.Content,{children:[F.length>0&&e.jsx(Os,{currentFolder:V,selected:F,onSuccess:Ie}),j===0&&m===0&&e.jsx(Ns,{canCreate:a,canRead:n,isFiltering:h,onActionClick:G}),n&&!v&&(m>0||j>0)&&e.jsx(ys,{assetCount:m,folderCount:j,indeterminate:ne,onChangeSort:re,onChangeFolder:(t,w)=>s(E(g,r,{folder:t.toString(),folderPath:w})),onEditAsset:Q,onEditFolder:le,onSelectOne:O,onSelectAll:ie,rows:[...R,...D],selected:F,shouldDisableBulkSelect:!o,sortQuery:r?.sort??""}),n&&v&&e.jsxs(e.Fragment,{children:[j>0&&e.jsx(bs,{title:(h&&m>0||!h)&&l({id:c("list.folders.title"),defaultMessage:"Folders ({count})"},{count:j})||"",children:R.map(t=>{const Be=!!F.filter(({type:N})=>N==="folder").find(N=>N.id===t.id),ce=E(g,r,{folder:t?.id.toString(),folderPath:t?.path});return e.jsx(q.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(Cs,{ref:z&&t.id===z.id?f:void 0,ariaLabel:t.name,id:`folder-${t.id}`,to:ce,startAction:t.isSelectable?e.jsx($s,{"data-testid":`folder-checkbox-${t.id}`,checked:Be,onCheckedChange:()=>O(t)}):null,cardActions:e.jsx(W,{label:l({id:c("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>le(t),children:e.jsx(Ms,{})}),children:e.jsx(Fs,{children:e.jsx(ks,{to:ce,children:e.jsxs($,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(je,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[t.name,e.jsx(Ss,{children:":"})]}),e.jsx(je,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:l({id:c("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:t.children?.count,filesCount:t.files?.count})})]})})})})},`folder-${t.id}`)})}),m>0&&j>0&&e.jsx(T,{paddingTop:6,paddingBottom:4,children:e.jsx(vs,{})}),m>0&&e.jsx(Ls,{assets:D,onEditAsset:Q,onSelectAsset:O,selectedAssets:F.filter(({type:t})=>t==="asset"),title:(!h||h&&j>0)&&y?.pagination?.page===1&&l({id:c("list.assets.title"),defaultMessage:"Assets ({count})"},{count:Ee})||""})]}),e.jsxs(H.Root,{...y?.pagination,children:[e.jsx(H.PageSize,{}),e.jsx(H.Links,{})]})]})]}),Z&&e.jsx(ws,{open:Z,onClose:G,trackedLocation:"upload",folderId:r?.folder}),ee&&e.jsx(Es,{open:ee,onClose:()=>De(),folder:z,parentFolderId:r?.folder,location:"upload"}),U&&e.jsx(As,{onClose:t=>{t===null&&de(1),Q(void 0)},open:!!U,asset:U,canUpdate:o,canCopyLink:d,canDownload:i,trackedLocation:"upload"})]})},Xs=C.lazy(async()=>Bs(()=>import("./ConfigureTheView-C7dCFnlI.js"),__vite__mapDeps([0,1,2])).then(s=>({default:s.ConfigureTheView}))),Js=()=>{const{config:{isLoading:s,isError:n,data:a}}=Ds(),[{rawQuery:o},d]=P(),{formatMessage:i}=M(),u=i({id:c("plugin.name"),defaultMessage:"Media Library"});return C.useEffect(()=>{s||n||o||d({sort:a.sort,page:1,pageSize:a.pageSize})},[s,n,a,o,d]),s?e.jsx(L.Loading,{}):e.jsxs(L.Main,{children:[e.jsx(L.Title,{children:u}),o?e.jsx(C.Suspense,{fallback:e.jsx(L.Loading,{}),children:e.jsxs(Is,{children:[e.jsx(he,{index:!0,element:e.jsx(qs,{})}),e.jsx(he,{path:"configuration",element:e.jsx(Xs,{config:a})})]})}):null]})};export{Js as Upload};
