import{bd as Q,be as S,bf as Y,bg as y,a as c,b as $,y as T,bh as Z,aZ as J,x as K,ab as W,r as P,bi as X,bj as ee,j as e,P as b,E as se,D as x,bb as E,bk as ae,ae as p,p as g,s as l,bl as d,bm as M,bn as te,bo as re,bp as ie,bq as I}from"./strapi-CZE0NOhr.js";import{a as oe}from"./users-Dre-oh2V.js";import{C as ne}from"./validation-DIa_5QuO.js";const le=Q().shape({...ne,currentPassword:S().when(["password","confirmPassword"],(a,s,r)=>a||s?r.required({id:Y.required.id,defaultMessage:"This field is required"}).nullable():r),preferedLanguage:S().nullable()}),f=({children:a,...s})=>e.jsx(p,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsx(g,{direction:"column",alignItems:"stretch",gap:4,...s,children:a})}),ye=()=>{const a=y(o=>o.admin_app.language.localeNames),{formatMessage:s}=c(),{trackUsage:r}=$(),{toggleNotification:t}=T(),{notifyStatus:i}=Z(),v=y(o=>o.admin_app.theme.currentTheme),A=J(),{_unstableFormatValidationErrors:L,_unstableFormatAPIError:R}=K(),u=W("ProfilePage",o=>o.user);P.useEffect(()=>{u?i(s({id:"Settings.profile.form.notify.data.loaded",defaultMessage:"Your profile data has been loaded"})):t({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occured"})})},[s,i,t,u]);const[_,{isLoading:C}]=X(),{isLoading:k,data:z,error:j}=ee(void 0,{skip:!(window.strapi.isEE&&window.strapi.features.isEnabled("sso"))});P.useEffect(()=>{j&&t({type:"danger",message:s({id:"Settings.permissions.users.sso.provider.error"})})},[j,s,t]);const N=async(o,{setErrors:h})=>{const{confirmPassword:pe,currentTheme:w,...H}=o;let m=H;if(m.password===""){const{password:ge,currentPassword:fe,...V}=m;m=V}const n=await _(m);"data"in n&&(A(ie(w)),r("didChangeMode",{newMode:w}),t({type:"success",message:s({id:"notification.success.saved",defaultMessage:"Saved"})})),"error"in n&&(I(n.error)&&n.error.name==="ValidationError"?h(L(n.error)):I(n.error)?t({type:"danger",message:R(n.error)}):t({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occured"})}))};if(k)return e.jsx(b.Loading,{});const F=z?.isSSOLocked??!1,{email:O,firstname:U,lastname:q,username:B,preferedLanguage:D}=u??{},G={email:O??"",firstname:U??"",lastname:q??"",username:B??"",preferedLanguage:D,currentTheme:v,confirmPassword:"",password:""};return e.jsxs(b.Main,{"aria-busy":C,children:[e.jsx(b.Title,{children:s({id:"Settings.profile.form.section.head.title",defaultMessage:"User profile"})}),e.jsx(se,{method:"PUT",onSubmit:N,initialValues:G,validationSchema:le,children:({isSubmitting:o,modified:h})=>e.jsxs(e.Fragment,{children:[e.jsx(x.Header,{title:oe(u),primaryAction:e.jsx(E,{startIcon:e.jsx(ae,{}),loading:o,type:"submit",disabled:!h,children:s({id:"global.save",defaultMessage:"Save"})})}),e.jsx(p,{paddingBottom:6,children:e.jsx(x.Content,{children:e.jsxs(g,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsx(ue,{}),!F&&e.jsx(de,{}),e.jsx(ce,{localeNames:a})]})})})]})}),e.jsx(p,{paddingBottom:10,children:e.jsx(x.Content,{children:e.jsx(me,{})})})]})},de=()=>{const{formatMessage:a}=c();return e.jsxs(f,{children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"global.change-password",defaultMessage:"Change password"})}),[[{label:a({id:"Auth.form.currentPassword.label",defaultMessage:"Current Password"}),name:"currentPassword",size:6,type:"password"}],[{autoComplete:"new-password",label:a({id:"global.password",defaultMessage:"Password"}),name:"password",size:6,type:"password"},{autoComplete:"new-password",label:a({id:"Auth.form.confirmPassword.label",defaultMessage:"Confirm Password"}),name:"confirmPassword",size:6,type:"password"}]].map((s,r)=>e.jsx(d.Root,{gap:5,children:s.map(({size:t,...i})=>e.jsx(d.Item,{col:t,direction:"column",alignItems:"stretch",children:e.jsx(M,{...i})},i.name))},r))]})},ce=({localeNames:a})=>{const{formatMessage:s}=c(),r=y(t=>t.admin_app.theme.availableThemes);return e.jsxs(f,{children:[e.jsxs(g,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsx(l,{variant:"delta",tag:"h2",children:s({id:"Settings.profile.form.section.experience.title",defaultMessage:"Experience"})}),e.jsx(l,{children:s({id:"Settings.profile.form.section.experience.interfaceLanguageHelp",defaultMessage:"Preference changes will apply only to you. More information is available {here}."},{here:e.jsx(p,{tag:"a",color:"primary600",target:"_blank",rel:"noopener noreferrer",href:"https://docs.strapi.io/developer-docs/latest/development/admin-customization.html#locales",children:s({id:"Settings.profile.form.section.experience.here",defaultMessage:"here"})})})})]}),e.jsx(d.Root,{gap:5,children:[{hint:s({id:"Settings.profile.form.section.experience.interfaceLanguage.hint",defaultMessage:"This will only display your own interface in the chosen language."}),label:s({id:"Settings.profile.form.section.experience.interfaceLanguage",defaultMessage:"Interface language"}),name:"preferedLanguage",options:Object.entries(a).map(([t,i])=>({label:i,value:t})),placeholder:s({id:"global.select",defaultMessage:"Select"}),size:6,type:"enumeration"},{hint:s({id:"Settings.profile.form.section.experience.mode.hint",defaultMessage:"Displays your interface in the chosen mode."}),label:s({id:"Settings.profile.form.section.experience.mode.label",defaultMessage:"Interface mode"}),name:"currentTheme",options:[{label:s({id:"Settings.profile.form.section.experience.mode.option-system-label",defaultMessage:"Use system settings"}),value:"system"},...r.map(t=>({label:s({id:"Settings.profile.form.section.experience.mode.option-label",defaultMessage:"{name} mode"},{name:s({id:t,defaultMessage:te(t)})}),value:t}))],placeholder:s({id:"components.Select.placeholder",defaultMessage:"Select"}),size:6,type:"enumeration"}].map(({size:t,...i})=>e.jsx(d.Item,{col:t,direction:"column",alignItems:"stretch",children:e.jsx(M,{...i})},i.name))})]})},ue=()=>{const{formatMessage:a}=c();return e.jsxs(f,{children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"global.profile",defaultMessage:"Profile"})}),e.jsx(d.Root,{gap:5,children:[{label:a({id:"Auth.form.firstname.label",defaultMessage:"First name"}),name:"firstname",required:!0,size:6,type:"string"},{label:a({id:"Auth.form.lastname.label",defaultMessage:"Last name"}),name:"lastname",size:6,type:"string"},{label:a({id:"Auth.form.email.label",defaultMessage:"Email"}),name:"email",required:!0,size:6,type:"email"},{label:a({id:"Auth.form.username.label",defaultMessage:"Username"}),name:"username",size:6,type:"string"}].map(({size:s,...r})=>e.jsx(d.Item,{col:s,direction:"column",alignItems:"stretch",children:e.jsx(M,{...r})},r.name))})]})},me=()=>{const{formatMessage:a}=c(),{toggleNotification:s}=T(),r=re("ProfilePage",i=>i.dispatch),t=()=>{r({type:"reset_all_tours"}),s({type:"success",message:a({id:"tours.profile.notification.success.reset",defaultMessage:"Guided tour reset"})})};return e.jsxs(f,{alignItems:"start",children:[e.jsxs(g,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"tours.profile.title",defaultMessage:"Guided tour"})}),e.jsx(l,{variant:"pi",children:a({id:"tours.profile.description",defaultMessage:"You can reset the guided tour at any time."})})]}),e.jsx(E,{variant:"tertiary",onClick:t,children:a({id:"tours.profile.reset",defaultMessage:"Reset guided tour"})})]})};export{ye as ProfilePage};
