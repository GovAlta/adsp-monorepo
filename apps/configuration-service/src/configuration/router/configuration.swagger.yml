components:
  schemas:
    ConfigurationRevision:
      type: object
      properties:
        revision:
          type: number
        configuration:
          type: object
    UpdateOperation:
      type: object
      properties:
        operation:
          type: string
          enum: [UPDATE]
        update:
          type: object
      required: [operation, update]
    ReplaceOperation:
      type: object
      properties:
        operation:
          type: string
          enum: [REPLACE]
        configuration:
          type: object
      required: [operation, configuration]
    DeleteOperation:
      type: object
      properties:
        operation:
          type: string
          enum: [DELETE]
        property:
          type: string
      required: [operation, property]

/configuration/v2/configuration/{namespace}/{name}:
  parameters:
    - name: namespace
      description: Namespace of the configuration.
      in: path
      required: true
      schema:
        type: string
    - name: name
      description: Name of the configuration.
      in: path
      required: true
      schema:
        type: string
  get:
    tags:
      - Configuration
    description: Retrieves configuration.
    parameters:
      - name: core
        description: Flag indicating if the core instead of tenant configuration should be retrieved.
        in: query
        required: false
        schema: {}
    responses:
      200:
        description: Request completed successfully.
        content:
          application/json:
            schema:
              type: object
              properties:
                namespace:
                  type: string
                name:
                  type: string
                latest:
                  $ref: "#/components/schemas/ConfigurationRevision"
      401:
        description: User not authorized to retrieve configuration.
  patch:
    tags:
      - Configuration
    description: |
      Updates the configuration revision.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/ReplaceOperation"
              - $ref: "#/components/schemas/UpdateOperation"
              - $ref: "#/components/schemas/DeleteOperation"
            discriminator:
              propertyName: operation
              mapping:
                REPLACE: "#/components/schemas/ReplaceOperation"
                UPDATE: "#/components/schemas/UpdateOperation"
                DELETE: "#/components/schemas/DeleteOperation"
    responses:
      200:
        description: Request completed successfully.
        content:
          application/json:
            schema:
              type: object
              properties:
                namespace:
                  type: string
                name:
                  type: string
                latest:
                  $ref: "#/components/schemas/ConfigurationRevision"
      401:
        description: User not authorized to update configuration.
  post:
    tags:
      - Configuration
    description: Creates a new revision of configuration.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              revision:
                type: boolean
    responses:
      200:
        description: Request completed successfully.
        content:
          application/json:
            schema:
              type: object
              properties:
                namespace:
                  type: string
                name:
                  type: string
                latest:
                  $ref: "#/components/schemas/ConfigurationRevision"
      401:
        description: User not authorized to update configuration.

/configuration/v2/configuration/{namespace}/{name}/latest:
  get:
    tags:
      - Configuration
    description: Retrieves the latest revision of configuration.
    parameters:
      - name: namespace
        description: Namespace of the configuration.
        in: path
        required: true
        schema:
          type: string
      - name: name
        description: Name of the configuration.
        in: path
        required: true
        schema:
          type: string
      - name: core
        description: Flag indicating if core instead of tenant configuration should be retrieved.
        in: query
        required: false
        schema: {}
    responses:
      200:
        description: Request completed successfully.
        content:
          application/json:
            schema:
              type: object
      401:
        description: User not authorized to retrieve configuration.

/configuration/v2/configuration/{namespace}/{name}/revisions:
  get:
    tags:
      - Configuration
    description: Retrieves the revisions of configuration.
    parameters:
      - name: namespace
        description: Namespace of the configuration.
        in: path
        required: true
        schema:
          type: string
      - name: name
        description: Name of the configuration.
        in: path
        required: true
        schema:
          type: string
      - name: top
        description: Number of revisions to return in a page.
        in: query
        required: false
        schema:
          type: number
      - name: after
        description: Cursor for retrieving additional pages.
        in: query
        required: false
        schema:
          type: string
    responses:
      200:
        description: Request completed successfully.
        content:
          application/json:
            schema:
              type: object
              properties:
                results:
                  type: array
                  items:
                    $ref: "#/components/schemas/ConfigurationRevision"
                page:
                  type: object
                  properties:
                    after:
                      type: string
                    next:
                      type: string
                    size:
                      type: number
      401:
        description: User not authorized to retrieve configuration.

/configuration/v2/configuration/{namespace}/{name}/revisions/{revision}:
  get:
    tags:
      - Configuration
    description: Retrieves a specific revision of configuration.
    parameters:
      - name: namespace
        description: Namespace of the configuration.
        in: path
        required: true
        schema:
          type: string
      - name: name
        description: Name of the configuration.
        in: path
        required: true
        schema:
          type: string
      - name: revision
        description: Revision number to retrieve.
        in: path
        required: true
        schema:
          type: number
    responses:
      200:
        description: Request completed successfully.
        content:
          application/json:
            schema:
              type: object
      401:
        description: User not authorized to retrieve configuration.
      404:
        description: Revision cannot be found.
